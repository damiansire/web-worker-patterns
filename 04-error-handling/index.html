<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>04 - Manejo de Errores</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>‚ö†Ô∏è Manejo de Errores en Workers</h1>
        <p class="subtitle">Ejemplo 04: Capturando y manejando errores</p>

        <div class="info-box">
            <strong>üí° ¬øQu√© demuestra este ejemplo?</strong>
            Los errores que ocurren dentro de un Web Worker deben ser manejados adecuadamente.
            Este ejemplo muestra diferentes tipos de errores y c√≥mo capturarlos usando el evento <code>onerror</code>.
        </div>

        <details class="code-explanation">
            <summary>üìñ Ver C√≥digo - ¬øC√≥mo funciona?</summary>
            
            <div class="code-section">
                <h3>1Ô∏è‚É£ Crear Worker y Configurar Error Handler (main.js)</h3>
                <pre><code>const worker = new Worker('worker.js');

// Capturar errores del worker
worker.onerror = function(error) {
    console.error('Error en worker:', error.message);
    console.error('Archivo:', error.filename);
    console.error('L√≠nea:', error.lineno);
    
    // Prevenir que el error se propague
    error.preventDefault();
};</code></pre>
            </div>

            <div class="code-section">
                <h3>2Ô∏è‚É£ Provocar Error en Worker (worker.js)</h3>
                <pre><code>self.onmessage = function(e) {
    // Esto causar√° un ReferenceError
    funcionQueNoExiste();
    
    // O lanzar un error personalizado
    throw new Error('Error personalizado');
};</code></pre>
            </div>

            <div class="code-section">
                <h3>3Ô∏è‚É£ Manejo de Errores con Try-Catch (worker.js)</h3>
                <pre><code>self.onmessage = function(e) {
    try {
        // C√≥digo que puede fallar
        const result = operacionPeligrosa();
        
        // Enviar resultado si todo va bien
        self.postMessage({ success: true, result });
    } catch (error) {
        // Enviar error como mensaje
        self.postMessage({ 
            success: false, 
            error: error.message 
        });
    }
};</code></pre>
            </div>

            <div class="code-section">
                <h3>4Ô∏è‚É£ Recibir Mensajes de Error (main.js)</h3>
                <pre><code>worker.onmessage = function(e) {
    if (e.data.success) {
        console.log('√âxito:', e.data.result);
    } else {
        console.error('Error:', e.data.error);
        // Manejar el error en la UI
    }
};</code></pre>
            </div>

            <div class="code-flow">
                <h3>üîÑ Dos Formas de Manejar Errores</h3>
                <div class="error-methods">
                    <div class="method-item">
                        <h4>1. Event Handler (onerror)</h4>
                        <p>‚Ä¢ Captura errores no manejados</p>
                        <p>‚Ä¢ Incluye informaci√≥n de l√≠nea/archivo</p>
                        <p>‚Ä¢ No puede enviar datos al hilo principal</p>
                    </div>
                    <div class="method-item">
                        <h4>2. Try-Catch + postMessage</h4>
                        <p>‚Ä¢ Control fino de errores</p>
                        <p>‚Ä¢ Puede enviar detalles al hilo principal</p>
                        <p>‚Ä¢ Permite recuperaci√≥n elegante</p>
                    </div>
                </div>
            </div>
        </details>

        <div class="error-types">
            <div class="error-card">
                <h3>‚ùå 1. Error de Referencia</h3>
                <p>Intentar usar una funci√≥n o variable que no existe.</p>
                <button onclick="triggerError('reference')">
                    Provocar ReferenceError
                </button>
            </div>

            <div class="error-card">
                <h3>üî¢ 2. Error de Tipo</h3>
                <p>Intentar realizar una operaci√≥n con un tipo de dato incorrecto.</p>
                <button onclick="triggerError('type')">
                    Provocar TypeError
                </button>
            </div>

            <div class="error-card">
                <h3>‚ûó 3. Error de Divisi√≥n</h3>
                <p>Operaciones matem√°ticas inv√°lidas o problemas aritm√©ticos.</p>
                <button onclick="triggerError('math')">
                    Provocar Error Matem√°tico
                </button>
            </div>

            <div class="error-card">
                <h3>üéØ 4. Error Personalizado</h3>
                <p>Lanzar un error custom con un mensaje espec√≠fico.</p>
                <button onclick="triggerError('custom')">
                    Lanzar Error Personalizado
                </button>
            </div>

            <div class="error-card">
                <h3>‚úÖ 5. Operaci√≥n Exitosa</h3>
                <p>Enviar una operaci√≥n que se completa sin errores.</p>
                <button onclick="triggerError('success')">
                    Ejecutar sin Errores
                </button>
            </div>
        </div>

        <div class="console">
            <div class="console-header">
                <span class="title">üìã Consola de Eventos</span>
                <button onclick="clearConsole()">Limpiar</button>
            </div>
            <div id="logContainer">
                <div class="log-entry info">
                    <span class="timestamp">[00:00:00]</span>
                    Sistema iniciado. Esperando acciones...
                </div>
            </div>
        </div>
    </div>

    <script src="main.js"></script>
</body>
</html>

