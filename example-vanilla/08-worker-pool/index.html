<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>08 - Worker Pool</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>‚ôªÔ∏è Worker Pool Pattern</h1>
        <p class="subtitle">Ejemplo 10: Procesar muchas tareas con pocos workers</p>

        <div class="info-box">
            <strong>üí° ¬øQu√© demuestra este ejemplo?</strong>
            En lugar de crear un worker por tarea (lo cual tiene l√≠mites), un Worker Pool reutiliza 
            un n√∫mero fijo de workers para procesar m√∫ltiples tareas en cola. Esto es el patr√≥n usado 
            en aplicaciones de producci√≥n.
        </div>

        <div class="comparison-box">
            <div class="comparison-column bad">
                <h4>‚ùå Enfoque Malo</h4>
                <ul>
                    <li>Crear 1 worker por tarea</li>
                    <li>100 tareas = 100 workers</li>
                    <li>Alcanza l√≠mites del navegador</li>
                    <li>Alto consumo de memoria</li>
                </ul>
            </div>
            <div class="comparison-column good">
                <h4>‚úÖ Worker Pool</h4>
                <ul>
                    <li>Pool fijo de 4-8 workers</li>
                    <li>100 tareas = 4-8 workers reutilizados</li>
                    <li>Sin l√≠mites de tareas</li>
                    <li>Uso eficiente de recursos</li>
                </ul>
            </div>
        </div>

        <details class="code-explanation">
            <summary>üìñ Ver C√≥digo - ¬øC√≥mo funciona?</summary>
            
            <div class="code-section">
                <h3>1Ô∏è‚É£ Crear Worker Pool (main.js)</h3>
                <pre><code><span class="keyword">class</span> <span class="function">WorkerPool</span> {
    <span class="function">constructor</span>(<span class="variable">poolSize</span>, <span class="variable">workerScript</span>) {
        <span class="keyword">this</span>.<span class="property">poolSize</span> = <span class="variable">poolSize</span>;
        <span class="keyword">this</span>.<span class="property">workers</span> = [];
        <span class="keyword">this</span>.<span class="property">taskQueue</span> = [];
        
        <span class="comment">// Crear workers fijos</span>
        <span class="keyword">for</span> (<span class="keyword">let</span> <span class="variable">i</span> = <span class="number">0</span>; <span class="variable">i</span> < <span class="variable">poolSize</span>; <span class="variable">i</span>++) {
            <span class="keyword">const</span> <span class="variable">worker</span> = <span class="keyword">new</span> <span class="function">Worker</span>(<span class="variable">workerScript</span>);
            <span class="keyword">this</span>.<span class="property">workers</span>.<span class="function">push</span>({
                <span class="property">id</span>: <span class="variable">i</span>,
                <span class="property">instance</span>: <span class="variable">worker</span>,
                <span class="property">busy</span>: <span class="keyword">false</span>
            });
        }
    }
}</code></pre>
            </div>

            <div class="code-section">
                <h3>2Ô∏è‚É£ Agregar Tareas a la Cola (main.js)</h3>
                <pre><code><span class="function">addTask</span>(<span class="variable">task</span>) {
    <span class="comment">// Agregar a la cola</span>
    <span class="keyword">this</span>.<span class="property">taskQueue</span>.<span class="function">push</span>(<span class="variable">task</span>);
    
    <span class="comment">// Procesar inmediatamente si hay workers libres</span>
    <span class="keyword">this</span>.<span class="function">processQueue</span>();
}</code></pre>
            </div>

            <div class="code-section">
                <h3>3Ô∏è‚É£ Asignar Tareas a Workers (main.js)</h3>
                <pre><code><span class="function">processQueue</span>() {
    <span class="comment">// Buscar workers disponibles</span>
    <span class="keyword">const</span> <span class="variable">available</span> = <span class="keyword">this</span>.<span class="property">workers</span>.<span class="function">filter</span>(<span class="variable">w</span> => !<span class="variable">w</span>.<span class="property">busy</span>);
    
    <span class="variable">available</span>.<span class="function">forEach</span>(<span class="variable">worker</span> => {
        <span class="keyword">if</span> (<span class="keyword">this</span>.<span class="property">taskQueue</span>.<span class="property">length</span> > <span class="number">0</span>) {
            <span class="keyword">const</span> <span class="variable">task</span> = <span class="keyword">this</span>.<span class="property">taskQueue</span>.<span class="function">shift</span>();
            <span class="variable">worker</span>.<span class="property">busy</span> = <span class="keyword">true</span>;
            <span class="variable">worker</span>.<span class="property">instance</span>.<span class="function">postMessage</span>(<span class="variable">task</span>);
        }
    });
}</code></pre>
            </div>

            <div class="code-section">
                <h3>4Ô∏è‚É£ Recibir Resultados (main.js)</h3>
                <pre><code><span class="variable">worker</span>.<span class="property">instance</span>.<span class="property">onmessage</span> = (<span class="variable">e</span>) => {
    <span class="comment">// Marcar worker como disponible</span>
    <span class="variable">worker</span>.<span class="property">busy</span> = <span class="keyword">false</span>;
    
    <span class="comment">// Procesar siguiente tarea</span>
    <span class="keyword">this</span>.<span class="function">processQueue</span>();
    
    <span class="comment">// Manejar resultado</span>
    <span class="function">handleResult</span>(<span class="variable">e</span>.<span class="property">data</span>);
};</code></pre>
            </div>

            <div class="code-flow">
                <h3>‚ôªÔ∏è Flujo del Worker Pool</h3>
                <div class="pool-diagram">
                    <div class="diagram-section">
                        <strong>Cola de Tareas</strong>
                        <div class="queue-viz">
                            [Tarea 5] [Tarea 6] [Tarea 7] ...
                        </div>
                    </div>
                    <div class="diagram-arrow">‚¨áÔ∏è</div>
                    <div class="diagram-section">
                        <strong>Pool de Workers</strong>
                        <div class="workers-viz">
                            Worker 1 [ocupado]<br>
                            Worker 2 [libre]<br>
                            Worker 3 [ocupado]<br>
                            Worker 4 [libre]
                        </div>
                    </div>
                </div>
                <p style="font-size: 12px; margin-top: 15px; text-align: center; color: #666;">
                    üí° Patr√≥n profesional para aplicaciones de producci√≥n
                </p>
            </div>
        </details>

        <div class="stats-dashboard">
            <h3>üìä Dashboard del Pool</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üë∑</div>
                    <div class="stat-value" id="poolSize">0</div>
                    <div class="stat-label">Workers en el Pool</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚è≥</div>
                    <div class="stat-value" id="queueSize">0</div>
                    <div class="stat-label">Tareas en Cola</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üîÑ</div>
                    <div class="stat-value" id="processing">0</div>
                    <div class="stat-label">Procesando Ahora</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-value" id="completed">0</div>
                    <div class="stat-label">Completadas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚ö°</div>
                    <div class="stat-value" id="throughput">0</div>
                    <div class="stat-label">Tareas/seg</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚è±Ô∏è</div>
                    <div class="stat-value" id="avgTime">-</div>
                    <div class="stat-label">Tiempo Promedio</div>
                </div>
            </div>
        </div>

        <div class="control-panel">
            <h3>üéÆ Controles</h3>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="poolSizeInput">Tama√±o del Pool:</label>
                    <input type="number" id="poolSizeInput" value="4" min="1" max="16">
                    <small>Recomendado: 4-8 workers</small>
                </div>
                <div class="form-group">
                    <button class="btn-primary" id="initPoolBtn">
                        üöÄ Inicializar Pool
                    </button>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="taskCount">Cantidad de Tareas:</label>
                    <input type="number" id="taskCount" value="20" min="1" max="1000">
                    <small>Puedes agregar m√°s tareas que workers</small>
                </div>
                <div class="form-group">
                    <label for="taskDuration">Duraci√≥n de cada tarea (ms):</label>
                    <input type="number" id="taskDuration" value="1000" min="100" max="5000" step="100">
                </div>
            </div>

            <div class="button-grid">
                <button class="btn-success" id="addTasksBtn" disabled>
                    ‚ûï Agregar Tareas
                </button>
                <button class="btn-stress" id="stress100Btn" disabled>
                    üî• Stress Test (100 tareas)
                </button>
                <button class="btn-danger" id="clearQueueBtn" disabled>
                    üóëÔ∏è Limpiar Cola
                </button>
                <button class="btn-secondary" id="shutdownBtn" disabled>
                    üõë Apagar Pool
                </button>
            </div>
        </div>

        <div class="visualization-panel">
            <h3>üëÅÔ∏è Visualizaci√≥n del Pool</h3>
            <div class="workers-container" id="workersContainer">
                <p style="color: #999; text-align: center; padding: 40px;">
                    Inicializa el pool para ver los workers en acci√≥n
                </p>
            </div>
        </div>

        <div class="queue-panel">
            <h3>üìã Cola de Tareas</h3>
            <div class="queue-visualization" id="queueVisualization">
                <p style="color: #999; text-align: center; padding: 20px;">
                    Las tareas en cola aparecer√°n aqu√≠
                </p>
            </div>
        </div>

        <div class="log-panel">
            <div class="log-header">
                <h3>üìù Log de Actividad</h3>
                <button class="btn-small" id="clearLogsBtn">Limpiar</button>
            </div>
            <div class="log-container" id="logContainer">
                <div class="log-entry info">
                    <span class="timestamp">[00:00:00]</span>
                    Sistema listo. Inicializa el pool para comenzar.
                </div>
            </div>
        </div>

        <div class="info-section">
            <h3>üí° ¬øC√≥mo funciona un Worker Pool?</h3>
            <div class="info-content">
                <div class="algorithm-steps">
                    <div class="step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>Inicializaci√≥n</h4>
                            <p>Se crea un n√∫mero fijo de workers (ej: 4)</p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>Encolado</h4>
                            <p>Las tareas se agregan a una cola (FIFO)</p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>Asignaci√≥n</h4>
                            <p>Cuando un worker est√° libre, toma la siguiente tarea</p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h4>Ejecuci√≥n</h4>
                            <p>El worker procesa la tarea y devuelve el resultado</p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">5</div>
                        <div class="step-content">
                            <h4>Reutilizaci√≥n</h4>
                            <p>El worker vuelve a estar disponible y toma otra tarea</p>
                        </div>
                    </div>
                </div>

                <h4>Ventajas del Worker Pool:</h4>
                <ul>
                    <li>‚úÖ Procesa infinitas tareas con recursos limitados</li>
                    <li>‚úÖ No alcanza l√≠mites del navegador</li>
                    <li>‚úÖ Uso eficiente de memoria y CPU</li>
                    <li>‚úÖ Rendimiento predecible y controlable</li>
                    <li>‚úÖ F√°cil de implementar y mantener</li>
                </ul>

                <h4>Casos de Uso Reales:</h4>
                <ul>
                    <li>Procesamiento de im√°genes por lotes</li>
                    <li>Validaci√≥n de formularios complejos</li>
                    <li>An√°lisis de datos en el cliente</li>
                    <li>Compresi√≥n/descompresi√≥n de archivos</li>
                    <li>C√°lculos cient√≠ficos o matem√°ticos</li>
                </ul>
            </div>
        </div>
    </div>

    <script src="main.js"></script>
</body>
</html>

