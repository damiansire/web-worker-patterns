<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>07 - LÃ­mites de Workers</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>âš ï¸ LÃ­mites de Workers</h1>
        <p class="subtitle">Ejemplo 09: Cantidad mÃ¡xima y gestiÃ³n de recursos</p>

        <div class="info-box">
            <strong>ğŸ’¡ Â¿QuÃ© demuestra este ejemplo?</strong>
            Los navegadores tienen lÃ­mites en la cantidad de workers que pueden ejecutarse simultÃ¡neamente.
            Este ejemplo te permite crear mÃºltiples workers y ver quÃ© sucede cuando alcanzas esos lÃ­mites.
        </div>

        <details class="code-explanation">
            <summary>ğŸ“– Ver CÃ³digo - Â¿CÃ³mo funciona?</summary>
            
            <div class="code-section">
                <h3>1ï¸âƒ£ Obtener Info del Sistema (main.js)</h3>
                <pre><code><span class="comment">// Detectar nÃºmero de nÃºcleos disponibles</span>
<span class="keyword">const</span> <span class="variable">cpuCores</span> = <span class="variable">navigator</span>.<span class="property">hardwareConcurrency</span> || <span class="number">4</span>;
<span class="variable">console</span>.<span class="function">log</span>(<span class="string">`NÃºcleos CPU: </span><span class="variable">${cpuCores}</span><span class="string">`</span>);</code></pre>
            </div>

            <div class="code-section">
                <h3>2ï¸âƒ£ Crear MÃºltiples Workers (main.js)</h3>
                <pre><code><span class="keyword">const</span> <span class="variable">workers</span> = [];

<span class="keyword">function</span> <span class="function">createWorkers</span>(<span class="variable">count</span>) {
    <span class="keyword">for</span> (<span class="keyword">let</span> <span class="variable">i</span> = <span class="number">0</span>; <span class="variable">i</span> < <span class="variable">count</span>; <span class="variable">i</span>++) {
        <span class="keyword">try</span> {
            <span class="keyword">const</span> <span class="variable">worker</span> = <span class="keyword">new</span> <span class="function">Worker</span>(<span class="string">'worker.js'</span>);
            <span class="variable">workers</span>.<span class="function">push</span>(<span class="variable">worker</span>);
            <span class="variable">console</span>.<span class="function">log</span>(<span class="string">`Worker </span><span class="variable">${i + 1}</span><span class="string"> creado`</span>);
        } <span class="keyword">catch</span> (<span class="variable">error</span>) {
            <span class="variable">console</span>.<span class="function">error</span>(<span class="string">'Error creando worker:'</span>, <span class="variable">error</span>);
            <span class="keyword">break</span>;
        }
    }
}</code></pre>
            </div>

            <div class="code-section">
                <h3>3ï¸âƒ£ Detectar LÃ­mites (main.js)</h3>
                <pre><code><span class="comment">// Intentar crear workers hasta encontrar el lÃ­mite</span>
<span class="keyword">let</span> <span class="variable">maxWorkers</span> = <span class="number">0</span>;
<span class="keyword">while</span> (<span class="variable">maxWorkers</span> < <span class="number">1000</span>) {
    <span class="keyword">try</span> {
        <span class="keyword">const</span> <span class="variable">w</span> = <span class="keyword">new</span> <span class="function">Worker</span>(<span class="string">'worker.js'</span>);
        <span class="variable">workers</span>.<span class="function">push</span>(<span class="variable">w</span>);
        <span class="variable">maxWorkers</span>++;
    } <span class="keyword">catch</span> (<span class="variable">e</span>) {
        <span class="variable">console</span>.<span class="function">log</span>(<span class="string">`LÃ­mite alcanzado: </span><span class="variable">${maxWorkers}</span><span class="string">`</span>);
        <span class="keyword">break</span>;
    }
}</code></pre>
            </div>

            <div class="code-section">
                <h3>4ï¸âƒ£ Gestionar Recursos (main.js)</h3>
                <pre><code><span class="comment">// Terminar workers para liberar recursos</span>
<span class="keyword">function</span> <span class="function">cleanupWorkers</span>() {
    <span class="variable">workers</span>.<span class="function">forEach</span>(<span class="variable">worker</span> => {
        <span class="variable">worker</span>.<span class="function">terminate</span>();
    });
    <span class="variable">workers</span>.<span class="property">length</span> = <span class="number">0</span>;
    <span class="variable">console</span>.<span class="function">log</span>(<span class="string">'Todos los workers terminados'</span>);
}</code></pre>
            </div>

            <div class="code-flow">
                <h3>ğŸ“Š LÃ­mites TÃ­picos por Navegador</h3>
                <div class="browser-limits">
                    <div class="limit-item">
                        <strong>Chrome/Edge:</strong> ~500-1000 workers
                    </div>
                    <div class="limit-item">
                        <strong>Firefox:</strong> ~250-500 workers
                    </div>
                    <div class="limit-item">
                        <strong>Safari:</strong> ~100-200 workers
                    </div>
                </div>
                <p style="font-size: 12px; margin-top: 15px; text-align: center; color: #666;">
                    ğŸ’¡ RecomendaciÃ³n: Usa mÃ¡ximo 1-2x el nÃºmero de nÃºcleos CPU
                </p>
            </div>
        </details>

        <div class="system-info-panel">
            <h3>ğŸ’» InformaciÃ³n de tu Sistema</h3>
            <div class="system-info-grid">
                <div class="info-item">
                    <div class="info-icon">ğŸ–¥ï¸</div>
                    <div class="info-content">
                        <div class="info-label">NÃºcleos CPU</div>
                        <div class="info-value" id="cpuCores">-</div>
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-icon">ğŸ“</div>
                    <div class="info-content">
                        <div class="info-label">LÃ­mite Recomendado</div>
                        <div class="info-value" id="recommendedLimit">-</div>
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-icon">ğŸŒ</div>
                    <div class="info-content">
                        <div class="info-label">Navegador</div>
                        <div class="info-value" id="browserInfo">-</div>
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-icon">ğŸ¯</div>
                    <div class="info-content">
                        <div class="info-label">LÃ­mite Detectado</div>
                        <div class="info-value" id="detectedLimit">No detectado</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="best-practices-panel">
            <h3>âœ¨ Mejores PrÃ¡cticas</h3>
            <div class="practices-grid">
                <div class="practice-item">
                    <div class="practice-icon">â™»ï¸</div>
                    <div class="practice-content">
                        <strong>Pool de Workers:</strong> Reutiliza workers en lugar de crear nuevos
                    </div>
                </div>
                <div class="practice-item">
                    <div class="practice-icon">ğŸ¯</div>
                    <div class="practice-content">
                        <strong>LÃ­mite Razonable:</strong> Usa 4-8 workers para la mayorÃ­a de aplicaciones
                    </div>
                </div>
                <div class="practice-item">
                    <div class="practice-icon">ğŸ“Š</div>
                    <div class="practice-content">
                        <strong>Monitoreo:</strong> Implementa contadores y limpieza automÃ¡tica
                    </div>
                </div>
                <div class="practice-item">
                    <div class="practice-icon">ğŸ›‘</div>
                    <div class="practice-content">
                        <strong>TerminaciÃ³n:</strong> Siempre termina workers cuando no los necesites
                    </div>
                </div>
            </div>
            <div class="code-example">
                <strong>Detectar lÃ­mites programÃ¡ticamente:</strong>
                <pre>const cpuCores = navigator.hardwareConcurrency || 4;
const maxWorkers = cpuCores * 2; // Regla general</pre>
            </div>
        </div>

        <div class="warning-box">
            <strong>âš ï¸ LÃ­mites tÃ­picos por navegador:</strong>
            <ul>
                <li><strong>Chrome/Edge:</strong> ~20-50 workers (depende de nÃºcleos CPU)</li>
                <li><strong>Firefox:</strong> ~20-30 workers</li>
                <li><strong>Safari:</strong> ~10-20 workers</li>
            </ul>
            <p style="margin-top: 10px;">
                El lÃ­mite real depende de: memoria disponible, nÃºcleos CPU, y configuraciÃ³n del navegador.
            </p>
        </div>

        <div class="stats-panel">
            <h3>ğŸ“Š Estado Actual</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Workers Activos</div>
                    <div class="stat-value active" id="activeCount">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Creados</div>
                    <div class="stat-value" id="totalCreated">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Errores</div>
                    <div class="stat-value error" id="errorCount">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Memoria Usada</div>
                    <div class="stat-value" id="memoryUsed">-</div>
                </div>
            </div>
        </div>

        <div class="auto-detect-panel">
            <h3>ğŸ” Auto-detecciÃ³n de LÃ­mites</h3>
            <p class="panel-description">
                Esta funciÃ³n crea workers progresivamente (1, 2, 3...) hasta encontrar el lÃ­mite real de tu navegador.
            </p>
            
            <div class="detect-controls">
                <button class="btn-detect" id="autoDetectBtn">
                    ğŸ” Detectar LÃ­mite AutomÃ¡ticamente
                </button>
                <button class="btn-stop" id="stopDetectBtn" disabled>
                    â¹ï¸ Detener DetecciÃ³n
                </button>
            </div>

            <div class="detect-status" id="detectStatus" style="display: none;">
                <div class="status-content">
                    <div class="status-icon">ğŸ”„</div>
                    <div class="status-text">
                        <strong>Detectando lÃ­mites...</strong>
                        <div id="detectProgress">Creando worker #1...</div>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="detectProgressBar"></div>
                </div>
            </div>

            <div class="detect-result" id="detectResult" style="display: none;">
                <h4>ğŸ“Š Resultado de la DetecciÃ³n</h4>
                <div class="result-stats">
                    <div class="result-item">
                        <span class="result-label">LÃ­mite Detectado:</span>
                        <span class="result-value" id="finalLimit">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Tiempo Total:</span>
                        <span class="result-value" id="detectionTime">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">vs Recomendado:</span>
                        <span class="result-value" id="vsRecommended">-</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="control-panel">
            <h3>ğŸ® Controles Manuales</h3>
            
            <div class="input-row">
                <label for="workerCount">Cantidad de workers a crear:</label>
                <input type="number" id="workerCount" value="10" min="1" max="100">
            </div>

            <div class="button-grid">
                <button class="btn-primary" id="createBtn">
                    â• Crear Workers
                </button>
                <button class="btn-stress" id="stressBtn">
                    ğŸ”¥ Test de EstrÃ©s (50 workers)
                </button>
                <button class="btn-danger" id="terminateAllBtn">
                    ğŸ›‘ Terminar Todos
                </button>
                <button class="btn-secondary" id="clearLogsBtn">
                    ğŸ—‘ï¸ Limpiar Logs
                </button>
            </div>

            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="autoCleanup" checked>
                    Auto-limpieza de workers inactivos (despuÃ©s de 10s)
                </label>
            </div>
        </div>

        <div class="workers-panel">
            <h3>ğŸ‘· Workers Activos</h3>
            <div class="workers-list" id="workersList">
                <p style="color: #999; text-align: center; padding: 20px;">
                    No hay workers activos. Crea algunos usando los botones de arriba.
                </p>
            </div>
        </div>

        <div class="log-panel">
            <h3>ğŸ“‹ Log de Eventos</h3>
            <div class="log-container" id="logContainer">
                <div class="log-entry info">
                    <span class="timestamp">[00:00:00]</span>
                    Sistema iniciado. Listo para crear workers.
                </div>
            </div>
        </div>

        <div class="info-section">
            <h3>ğŸ’¡ InformaciÃ³n Importante</h3>
            <div class="info-content">
                <h4>Â¿QuÃ© sucede cuando se excede el lÃ­mite?</h4>
                <ul>
                    <li>El navegador puede rechazar la creaciÃ³n de nuevos workers</li>
                    <li>Puede haber excepciones o errores silenciosos</li>
                    <li>El rendimiento general de la pÃ¡gina puede degradarse</li>
                    <li>Otros procesos del navegador pueden verse afectados</li>
                </ul>

                <h4>Mejores PrÃ¡cticas:</h4>
                <ul>
                    <li><strong>Pool de Workers:</strong> Reutiliza workers en lugar de crear nuevos</li>
                    <li><strong>LÃ­mite Razonable:</strong> Usa 4-8 workers para la mayorÃ­a de aplicaciones</li>
                    <li><strong>Monitoreo:</strong> Implementa contadores y limpieza automÃ¡tica</li>
                    <li><strong>TerminaciÃ³n:</strong> Siempre termina workers cuando no los necesites</li>
                </ul>

                <h4>Detectar lÃ­mites programÃ¡ticamente:</h4>
                <pre>const cpuCores = navigator.hardwareConcurrency || 4;
const maxWorkers = cpuCores * 2; // Regla general</pre>
            </div>
        </div>
    </div>

    <script src="main.js"></script>
</body>
</html>

