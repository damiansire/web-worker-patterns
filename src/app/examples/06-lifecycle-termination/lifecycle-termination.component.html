<div class="container">
  <h1>â™»ï¸ Ciclo de Vida y TerminaciÃ³n</h1>
  <p class="subtitle">Ejemplo 06: GestiÃ³n del ciclo de vida de Workers</p>

  <div class="info-box">
    <strong>ğŸ’¡ Â¿QuÃ© demuestra este ejemplo?</strong>
    Es importante gestionar correctamente el ciclo de vida de los Workers para liberar recursos y memoria.
    Este ejemplo muestra cÃ³mo crear, usar y terminar Workers de forma apropiada.
  </div>

  <details class="code-explanation">
    <summary>ğŸ“– Ver CÃ³digo - Â¿CÃ³mo funciona?</summary>
    <div class="code-section">
      <h3>1ï¸âƒ£ Crear Worker</h3>
      <pre><code>let worker = null;

function createWorker() {{'{'}}
    worker = new Worker('worker.js');
    worker.onmessage = handleMessage;
    worker.onerror = handleError;
{{ '}' }}</code></pre>
    </div>
    <div class="code-section">
      <h3>2ï¸âƒ£ Terminar Worker</h3>
      <pre><code>function terminateWorker() {{'{'}}
    if (worker) {{'{'}}
        worker.terminate();
        worker = null;
    {{ '}' }}
{{ '}' }}</code></pre>
    </div>
  </details>

  <div class="control-panel">
    <h3>ğŸ® Control del Worker</h3>
    
    <div class="status-indicator" [class.inactive]="workerStatus() === 'none'" [class.active]="workerStatus() === 'created' || workerStatus() === 'working'" [class.working]="workerStatus() === 'working'">
      <div class="status-dot"></div>
      <span>{{ workerStatus() === 'none' ? 'Worker no creado' : workerStatus() === 'created' ? 'Worker listo' : workerStatus() === 'working' ? 'Procesando...' : 'Completado' }}</span>
    </div>

    <div class="button-grid">
      <button class="btn-create" (click)="createWorker()" [disabled]="workerStatus() !== 'none'">â• Crear Worker</button>
      <button class="btn-start" (click)="startTask()" [disabled]="workerStatus() !== 'created'">â–¶ï¸ Iniciar Tarea Larga</button>
      <button class="btn-terminate" (click)="terminateWorker()" [disabled]="workerStatus() === 'none'">ğŸ›‘ Terminar Worker</button>
      <button (click)="clearLogs()">ğŸ—‘ï¸ Limpiar Logs</button>
    </div>

    <div class="progress-bar" [style.display]="workerStatus() === 'working' ? 'block' : 'none'">
      <div class="progress-fill" [style.width.%]="progress()">{{ progress() }}%</div>
    </div>
  </div>

  <div class="control-panel">
    <h3>ğŸ“Š EstadÃ­sticas</h3>
    <div class="stats-grid">
      <div class="stat-card">
        <div class="label">Workers Creados</div>
        <div class="value">{{ createdCount() }}</div>
      </div>
      <div class="stat-card">
        <div class="label">Tareas Completadas</div>
        <div class="value">{{ completedCount() }}</div>
      </div>
      <div class="stat-card">
        <div class="label">Terminaciones</div>
        <div class="value">{{ terminatedCount() }}</div>
      </div>
    </div>
  </div>

  <div class="log-container">
    <div class="log-header">
      <span class="title">ğŸ“‹ Log de Eventos</span>
      <button (click)="clearLogs()">Limpiar</button>
    </div>
    <div class="log-content">
      @if (logs().length === 0) {
        <div class="log-entry info">
          <span class="timestamp">Sistema iniciado. Esperando acciones...</span>
        </div>
      } @else {
        @for (log of logs(); track $index) {
          <div class="log-entry" [class.info]="log.type === 'info'" [class.success]="log.type === 'success'" [class.error]="log.type === 'error'" [class.warning]="log.type === 'warning'">
            <span class="timestamp">[{{ log.timestamp }}]</span>
            <span class="message">{{ log.message }}</span>
          </div>
        }
      }
    </div>
  </div>
</div>
