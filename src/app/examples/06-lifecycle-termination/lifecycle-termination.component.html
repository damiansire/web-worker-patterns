<div class="example-content">
  <h1>{{ texts().title }}</h1>
  <p class="subtitle">{{ texts().subtitle }}</p>

  <app-info-box [title]="texts().infoTitle">
    {{ texts().infoDescription }}
  </app-info-box>

  <app-code-explanation [summaryText]="texts().codeSummary">
    <app-code-section [title]="texts().codeSections?.createWorker">
      <pre><code>let worker = null;

function createWorker() {{'{'}}
    worker = new Worker('worker.js');
    worker.onmessage = handleMessage;
    worker.onerror = handleError;
{{ '}' }}</code></pre>
    </app-code-section>
    <app-code-section [title]="texts().codeSections?.terminateWorker">
      <pre><code>function terminateWorker() {{'{'}}
    if (worker) {{'{'}}
        worker.terminate();
        worker = null;
    {{ '}' }}
{{ '}' }}</code></pre>
    </app-code-section>
    <app-code-section tech="angular" [title]="texts().codeSections?.createWorker">
      <pre><code class="language-typescript">createWorker() {{ '{' }}
  if (this.worker) {{ '{' }}
    return;
  {{ '}' }}

  this.addLog(this.texts().logs?.creating ?? 'Creating worker...', 'info');

  this.worker = new Worker(
    new URL('./lifecycle-termination.worker', import.meta.url),
    {{ '{' }} type: 'module' {{ '}' }}
  );

  this.worker.onmessage = (event: MessageEvent<any>) => {{ '{' }}
    if (event.data.type === 'progress') {{ '{' }}
      this.progress.set(event.data.progress);
    {{ '}' }} else if (event.data.type === 'complete') {{ '{' }}
      this.workerStatus.set('completed');
      this.completedCount.update(c => c + 1);
      this.progress.set(0);
    {{ '}' }}
  {{ '}' }};

  this.worker.onerror = (error: ErrorEvent) => {{ '{' }}
    this.addLog(error.message, 'error');
  {{ '}' }};

  this.workerStatus.set('created');
  this.createdCount.update(c => c + 1);
{{ '}' }}</code></pre>
    </app-code-section>
    <app-code-section tech="angular" [title]="texts().codeSections?.terminateWorker">
      <pre><code class="language-typescript">terminateWorker() {{ '{' }}
  if (!this.worker) {{ '{' }}
    return;
  {{ '}' }}

  this.worker.terminate();
  this.worker = undefined;
  this.workerStatus.set('none');
  this.terminatedCount.update(c => c + 1);
  this.addLog(this.texts().logs?.workerTerminated ?? 'Worker terminated', 'warning');
{{ '}' }}</code></pre>
    </app-code-section>
  </app-code-explanation>

  <div class="control-panel">
    <h3>{{ texts().controlPanel?.title }}</h3>
    
    <div class="status-indicator" [class.inactive]="workerStatus() === 'none'" [class.active]="workerStatus() === 'created' || workerStatus() === 'working'" [class.working]="workerStatus() === 'working'">
      <div class="status-dot"></div>
      <span>{{ statusLabel() }}</span>
    </div>

    <div class="button-grid">
      <button class="btn-create" (click)="createWorker()" [disabled]="workerStatus() !== 'none'">
        {{ texts().controlPanel?.buttons?.create }}
      </button>
      <button class="btn-start" (click)="startTask()" [disabled]="workerStatus() !== 'created'">
        {{ texts().controlPanel?.buttons?.start }}
      </button>
      <button class="btn-terminate" (click)="terminateWorker()" [disabled]="workerStatus() === 'none'">
        {{ texts().controlPanel?.buttons?.terminate }}
      </button>
      <button (click)="clearLogs()">{{ texts().controlPanel?.buttons?.clear }}</button>
    </div>

    <div class="progress-bar" [style.display]="workerStatus() === 'working' ? 'block' : 'none'">
      <div class="progress-fill" [style.width.%]="progress()">{{ formatProgress() }}</div>
    </div>
  </div>

  <app-stats-panel [title]="texts().statsPanel?.title" [stats]="getStats()"></app-stats-panel>

  <app-log-panel 
    [logs]="logs()" 
    [title]="texts().logPanel?.title"
    [emptyMessage]="texts().logPanel?.empty"
    (clear)="clearLogs()">
  </app-log-panel>
</div>
