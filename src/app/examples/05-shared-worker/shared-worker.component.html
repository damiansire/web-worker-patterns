<div class="container">
  <h1>ğŸŒ Shared Worker</h1>
  <p class="subtitle">Ejemplo 05: ComunicaciÃ³n entre mÃºltiples pestaÃ±as</p>

  <app-info-box title="ğŸ’¡ Â¿QuÃ© demuestra este ejemplo?">
    Un Shared Worker puede ser compartido por mÃºltiples contextos de navegaciÃ³n (pestaÃ±as, iframes, ventanas).
    Es ideal para compartir estado, gestionar conexiones WebSocket compartidas, o sincronizar datos entre pestaÃ±as.
  </app-info-box>

  <div class="warning-box">
    âš ï¸ <strong>Nota de compatibilidad:</strong> Los Shared Workers no son soportados en todos los navegadores.
    Safari no los soporta. Firefox y Chrome sÃ­.
  </div>

  <app-code-explanation summaryText="ğŸ“– Ver CÃ³digo - Â¿CÃ³mo funciona?">
    <app-code-section title="1ï¸âƒ£ Crear Shared Worker">
      <pre><code>const sharedWorker = new SharedWorker('shared_worker.js');
const port = sharedWorker.port;
port.start();</code></pre>
    </app-code-section>
    <app-code-section title="2ï¸âƒ£ Conectar y Enviar">
      <pre><code>port.postMessage({{'{'}}
    type: 'message',
    tabId: 'tab-123',
    message: 'Hola desde pestaÃ±a 1'
{{ '}' }});</code></pre>
    </app-code-section>
  </app-code-explanation>

  <div class="status-panel">
    <h3>ğŸ“Š Estado de la ConexiÃ³n</h3>
    <div class="status-item">
      <span class="status-label">Estado del Worker:</span>
      <span class="status-value" [class.active]="workerStatus() === 'Conectado'">{{ workerStatus() }}</span>
    </div>
    <div class="status-item">
      <span class="status-label">Tu ID de PestaÃ±a:</span>
      <span class="status-value">{{ tabId() }}</span>
    </div>
    <div class="status-item">
      <span class="status-label">PestaÃ±as Conectadas:</span>
      <span class="status-value">{{ connectedTabs() }}</span>
    </div>
  </div>

  <div class="message-panel">
    <h3>ğŸ’¬ Chat entre PestaÃ±as</h3>
    
    <div class="input-group">
      <input 
        type="text" 
        placeholder="Escribe un mensaje..."
        [value]="messageText()"
        (input)="messageText.set($any($event.target).value)"
        (keypress)="onKeyPress($event)"
      >
      <button (click)="sendMessage()">Enviar</button>
    </div>

    <p class="instructions">
      ğŸ’¡ <strong>Abre esta misma pÃ¡gina en otra pestaÃ±a</strong> para ver cÃ³mo se comparten los mensajes
    </p>

    <div class="messages" [class.active]="messages().length > 0">
      @if (messages().length === 0) {
        <p class="empty-message">
          Los mensajes aparecerÃ¡n aquÃ­. Abre otra pestaÃ±a para probar la comunicaciÃ³n.
        </p>
      } @else {
        @for (msg of messages(); track $index) {
          <div class="message" [class.system]="msg.type === 'system'" [class.self]="msg.type === 'self'" [class.other]="msg.type === 'other'">
            <div class="sender">{{ msg.sender }}</div>
            <div class="text">{{ msg.text }}</div>
            <div class="timestamp">{{ msg.timestamp }}</div>
          </div>
        }
      }
    </div>
  </div>
</div>
