<div class="container">
  <h1>ğŸš€ Objetos Transferibles</h1>
  <p class="subtitle">Ejemplo 03: Transferencia vs. ClonaciÃ³n de datos</p>

  <app-info-box title="ğŸ’¡ Â¿QuÃ© demuestra este ejemplo?">
    Los objetos transferibles (como <code>ArrayBuffer</code>) pueden "transferir" su propiedad al worker 
    en lugar de ser clonados. Esto es muchÃ­simo mÃ¡s rÃ¡pido para grandes volÃºmenes de datos.
  </app-info-box>

  <app-code-explanation summaryText="ğŸ“– Ver CÃ³digo - Â¿CÃ³mo funciona?">
    <app-code-section title="1ï¸âƒ£ Crear ArrayBuffer">
      <pre><code>const imageData = new ImageData(1024, 1024);
const buffer = imageData.data.buffer;</code></pre>
    </app-code-section>
    <app-code-section title="2ï¸âƒ£ MÃ©todo 1: ClonaciÃ³n (Lento)">
      <pre><code>worker.postMessage({{'{'}} imageData: imageData {{'}'}});
// El buffer original sigue siendo accesible</code></pre>
    </app-code-section>
    <app-code-section title="3ï¸âƒ£ MÃ©todo 2: Transferencia (RÃ¡pido)">
      <pre><code>worker.postMessage({{'{'}} imageData: imageData {{'}'}}, [imageData.data.buffer]);
// âš ï¸ El buffer original queda INACCESIBLE</code></pre>
    </app-code-section>
  </app-code-explanation>

  <div class="demo-section">
    <h3>ğŸ–¼ï¸ Procesamiento de Imagen</h3>
    
    <div class="size-selector">
      <label>TamaÃ±o de los datos:</label>
      <select [ngModel]="sizeMB()" (ngModelChange)="sizeMB.set($event)">
        <option [value]="1">1 MB (256x256 imagen)</option>
        <option [value]="4">4 MB (512x512 imagen)</option>
        <option [value]="16">16 MB (1024x1024 imagen)</option>
        <option [value]="64">64 MB (2048x2048 imagen)</option>
      </select>
    </div>

    <div class="button-group">
      <button class="btn-transfer" (click)="processWithTransfer()" [disabled]="isLoading()">
        âš¡ Con Transferencia<br>
        <small style="font-size: 11px; font-weight: normal;">(Transfer ownership)</small>
      </button>
      <button class="btn-clone" (click)="processWithClone()" [disabled]="isLoading()">
        ğŸ“‹ Con ClonaciÃ³n<br>
        <small style="font-size: 11px; font-weight: normal;">(Structured clone)</small>
      </button>
    </div>

    <div class="spinner" [class.active]="isLoading()"></div>
    
    <div class="canvas-container" #canvasContainer></div>
  </div>

  <div class="comparison" [style.display]="(transferTime() > 0 && cloneTime() > 0) ? 'grid' : 'none'">
    <div class="comparison-item transfer">
      <div class="label">Con Transferencia</div>
      <div class="value">{{ transferTime() }}</div>
      <div class="unit">milisegundos</div>
    </div>
    <div class="comparison-item clone">
      <div class="label">Con ClonaciÃ³n</div>
      <div class="value">{{ cloneTime() }}</div>
      <div class="unit">milisegundos</div>
    </div>
  </div>

  @if (transferTime() > 0 && cloneTime() > 0) {
    <div class="result">
      <strong>ğŸ“Š AnÃ¡lisis de Rendimiento</strong>
      <p>
        <strong>Mejora con transferencia:</strong> {{ ((cloneTime() - transferTime()) / cloneTime() * 100).toFixed(1) }}% mÃ¡s rÃ¡pido<br>
        <strong>Diferencia:</strong> {{ cloneTime() - transferTime() }} ms ahorrados
      </p>
    </div>
  }
</div>
