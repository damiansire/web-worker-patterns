<div class="container">
  <h1>âš ï¸ LÃ­mites de Workers</h1>
  <p class="subtitle">Ejemplo 07: Cantidad mÃ¡xima y gestiÃ³n de recursos</p>

  <div class="info-box">
    <strong>ğŸ’¡ Â¿QuÃ© demuestra este ejemplo?</strong>
    Los navegadores tienen lÃ­mites en la cantidad de workers que pueden ejecutarse simultÃ¡neamente.
    Este ejemplo te permite crear mÃºltiples workers y ver quÃ© sucede cuando alcanzas esos lÃ­mites.
  </div>

  <details class="code-explanation">
    <summary>ğŸ“– Ver CÃ³digo - Â¿CÃ³mo funciona?</summary>
    <div class="code-section">
      <h3>1ï¸âƒ£ Obtener Info del Sistema</h3>
      <pre><code>const cpuCores = navigator.hardwareConcurrency || 4;</code></pre>
    </div>
    <div class="code-section">
      <h3>2ï¸âƒ£ Crear MÃºltiples Workers</h3>
      <pre><code>const workers = [];

for (let i = 0; i < count; i++) {{'{'}}
    try {{'{'}}
        const worker = new Worker('worker.js');
        workers.push(worker);
    {{ '}' }} catch (error) {{'{'}}
        console.error('Error:', error);
    {{ '}' }}
{{ '}' }}</code></pre>
    </div>
  </details>

  <div class="system-info-panel">
    <h3>ğŸ’» InformaciÃ³n de tu Sistema</h3>
    <div class="system-info-grid">
      <div class="info-item">
        <div class="info-icon">ğŸ–¥ï¸</div>
        <div class="info-content">
          <div class="info-label">NÃºcleos CPU</div>
          <div class="info-value">{{ getCPUCores() }}</div>
        </div>
      </div>
      <div class="info-item">
        <div class="info-icon">ğŸ“</div>
        <div class="info-content">
          <div class="info-label">LÃ­mite Recomendado</div>
          <div class="info-value">{{ getRecommendedMax() }} workers</div>
        </div>
      </div>
      <div class="info-item">
        <div class="info-icon">ğŸŒ</div>
        <div class="info-content">
          <div class="info-label">Navegador</div>
          <div class="info-value">{{ getBrowserInfo() }}</div>
        </div>
      </div>
      <div class="info-item">
        <div class="info-icon">ğŸ¯</div>
        <div class="info-content">
          <div class="info-label">LÃ­mite Detectado</div>
          <div class="info-value">{{ detectedLimit() }}</div>
        </div>
      </div>
    </div>
  </div>

  <div class="auto-detect-panel">
    <h3>ğŸ” Auto-detecciÃ³n de LÃ­mites</h3>
    <p class="panel-description">
      Esta funciÃ³n crea workers progresivamente (1, 2, 3...) hasta encontrar el lÃ­mite real de tu navegador.
    </p>
    
    <div class="detect-controls">
      <button class="btn-detect" (click)="autoDetectLimit()" [disabled]="detectionInProgress()">
        ğŸ” Detectar LÃ­mite AutomÃ¡ticamente
      </button>
      <button class="btn-stop" (click)="stopDetection()" [disabled]="!detectionInProgress()">
        â¹ï¸ Detener DetecciÃ³n
      </button>
    </div>

    @if (detectStatusVisible()) {
      <div class="detect-status">
        <div class="status-content">
          <div class="status-icon">ğŸ”„</div>
          <div class="status-text">
            <strong>Detectando lÃ­mites...</strong>
            <div>{{ detectProgress() }}</div>
          </div>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="detectProgressPercent()"></div>
        </div>
      </div>
    }

    @if (detectResultVisible()) {
      <div class="detect-result">
        <h4>ğŸ“Š Resultado de la DetecciÃ³n</h4>
        <div class="result-stats">
          <div class="result-item">
            <span class="result-label">LÃ­mite Detectado:</span>
            <span class="result-value">{{ detectResult().finalLimit }} workers</span>
          </div>
          <div class="result-item">
            <span class="result-label">Tiempo Total:</span>
            <span class="result-value">{{ detectResult().detectionTime }}</span>
          </div>
          <div class="result-item">
            <span class="result-label">vs Recomendado:</span>
            <span class="result-value">{{ detectResult().vsRecommended }}</span>
          </div>
        </div>
      </div>
    }
  </div>

  <div class="stats-panel">
    <h3>ğŸ“Š Estado Actual</h3>
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-label">Workers Activos</div>
        <div class="stat-value active">{{ activeCount() }}</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Total Creados</div>
        <div class="stat-value">{{ totalCreated() }}</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Errores</div>
        <div class="stat-value error">{{ errorCount() }}</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Memoria Usada</div>
        <div class="stat-value">{{ memoryUsed() }}</div>
      </div>
    </div>
  </div>

  <div class="control-panel">
    <h3>ğŸ® Controles Manuales</h3>
    
    <div class="input-row">
      <label>Cantidad de workers a crear:</label>
      <input type="number" [ngModel]="workerCount()" (ngModelChange)="workerCount.set($event)" min="1" max="100" />
    </div>

    <div class="button-grid">
      <button class="btn-primary" (click)="createWorker()">â• Crear 1 Worker</button>
      <button class="btn-create-multiple" (click)="createMultipleWorkers()">â•â• Crear {{ workerCount() }} Workers</button>
      <button class="btn-stress" (click)="stressTest()">ğŸ”¥ Test de EstrÃ©s (50)</button>
      <button class="btn-danger" (click)="terminateAll()">ğŸ›‘ Terminar Todos</button>
      <button class="btn-secondary" (click)="clearLogs()">ğŸ—‘ï¸ Limpiar Logs</button>
    </div>
  </div>

  <div class="log-panel">
    <h3>ğŸ“‹ Log de Eventos</h3>
    <div class="log-container" #logContainer>
      @if (logs().length === 0) {
        <div class="log-entry info">
          <span class="timestamp">Sistema iniciado. Listo para crear workers.</span>
        </div>
      } @else {
        @for (log of logs(); track $index) {
          <div class="log-entry" [class.info]="log.type === 'info'" [class.success]="log.type === 'success'" [class.error]="log.type === 'error'" [class.warning]="log.type === 'warning'">
            <span class="timestamp">[{{ log.timestamp }}]</span>
            <span class="message">{{ log.message }}</span>
          </div>
        }
      }
    </div>
  </div>
</div>

