<div class="example-content">
  <h1>ğŸŠ Worker Pool Pattern</h1>
  <p class="subtitle">Ejemplo 08: Procesar muchas tareas con pocos workers</p>

  <app-info-box title="ğŸ’¡ Â¿QuÃ© demuestra este ejemplo?">
    En lugar de crear un worker por tarea (lo cual tiene lÃ­mites), un Worker Pool reutiliza 
    un nÃºmero fijo de workers para procesar mÃºltiples tareas en cola. Esto es el patrÃ³n usado 
    en aplicaciones de producciÃ³n.
  </app-info-box>

  <div class="comparison-box">
    <div class="comparison-column bad">
      <h4>âŒ Enfoque Malo</h4>
      <ul>
        <li>Crear 1 worker por tarea</li>
        <li>100 tareas = 100 workers</li>
        <li>Alcanza lÃ­mites del navegador</li>
        <li>Alto consumo de memoria</li>
      </ul>
    </div>
    <div class="comparison-column good">
      <h4>âœ… Worker Pool</h4>
      <ul>
        <li>Pool fijo de 4-8 workers</li>
        <li>100 tareas = 4-8 workers reutilizados</li>
        <li>Sin lÃ­mites de tareas</li>
        <li>Uso eficiente de recursos</li>
      </ul>
    </div>
  </div>

  <app-code-explanation summaryText="ğŸ“– Ver CÃ³digo - Â¿CÃ³mo funciona?">
    <app-code-section title="1ï¸âƒ£ Crear Worker Pool">
      <pre><code>class WorkerPool {{'{'}}
    constructor(poolSize, workerScript) {{'{'}}
        this.poolSize = poolSize;
        this.workers = [];
        this.taskQueue = [];
        // Crear workers fijos
        for (let i = 0; i < poolSize; i++) {{'{'}}
            const worker = new Worker(workerScript);
            this.workers.push({{'{'}} id: i, instance: worker, busy: false {{ '}' }});
        {{ '}' }}
    {{ '}' }}
{{ '}' }}</code></pre>
    </app-code-section>
    <app-code-section title="2ï¸âƒ£ Agregar Tareas a la Cola">
      <pre><code>addTask(task) {{'{'}}
    this.taskQueue.push(task);
    this.processQueue();
{{ '}' }}</code></pre>
    </app-code-section>
    <app-code-section title="3ï¸âƒ£ Asignar Tareas a Workers">
      <pre><code>processQueue() {{'{'}}
    const available = this.workers.filter(w => !w.busy);
    available.forEach(worker => {{'{'}}
        if (this.taskQueue.length > 0) {{'{'}}
            const task = this.taskQueue.shift();
            worker.busy = true;
            worker.instance.postMessage(task);
        {{ '}' }}
    {{ '}' }});
{{ '}' }}</code></pre>
    </app-code-section>
    <app-code-section title="4ï¸âƒ£ Recibir Resultados">
      <pre><code>worker.instance.onmessage = (e) => {{'{'}}
    worker.busy = false;
    this.processQueue();
    handleResult(e.data);
{{ '}' }};</code></pre>
    </app-code-section>
  </app-code-explanation>

  <app-stats-panel title="ğŸ“Š Dashboard del Pool" [stats]="getStats()"></app-stats-panel>

  <div class="control-panel">
    <h3>ğŸ® Controles</h3>
    
    <div class="form-row">
      <div class="form-group">
        <label>TamaÃ±o del Pool:</label>
        <input type="number" [ngModel]="poolSizeInput()" (ngModelChange)="poolSizeInput.set($event)" min="1" max="16" />
        <small>Recomendado: 4-8 workers</small>
      </div>
      <div class="form-group">
        <button class="btn-primary" (click)="initializePool()">ğŸš€ Inicializar Pool</button>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label>Cantidad de Tareas:</label>
        <input type="number" [ngModel]="taskCount()" (ngModelChange)="taskCount.set($event)" min="1" max="1000" />
        <small>Puedes agregar mÃ¡s tareas que workers</small>
      </div>
      <div class="form-group">
        <label>DuraciÃ³n de cada tarea (ms):</label>
        <input type="number" [ngModel]="taskDuration()" (ngModelChange)="taskDuration.set($event)" min="100" max="5000" step="100" />
      </div>
    </div>

    <div class="button-grid">
      <button class="btn-success" (click)="addTasks()" [disabled]="!poolInitialized()">â• Agregar Tareas</button>
      <button class="btn-stress" (click)="stressTest()" [disabled]="!poolInitialized()">ğŸ”¥ Stress Test (100)</button>
      <button class="btn-danger" (click)="clearQueue()" [disabled]="!poolInitialized()">ğŸ—‘ï¸ Limpiar Cola</button>
      <button class="btn-secondary" (click)="shutdownPool()" [disabled]="!poolInitialized()">ğŸ›‘ Apagar Pool</button>
    </div>
  </div>

  <app-log-panel 
    [logs]="logs()" 
    title="ğŸ“ Log de Actividad"
    emptyMessage="Sistema listo. Inicializa el pool para comenzar."
    (clear)="clearLogs()">
  </app-log-panel>
</div>
