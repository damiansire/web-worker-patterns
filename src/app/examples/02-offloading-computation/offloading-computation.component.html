<div class="container">
  <h1>‚ö° Descarga de C√≥mputo Pesado</h1>
  <p class="subtitle">Ejemplo 02: Evitando el bloqueo de la UI</p>

  <app-info-box title="üí° ¬øQu√© demuestra este ejemplo?">
    Calcula n√∫meros primos de forma intensiva. Prueba ambos botones y observa c√≥mo el contador
    y la animaci√≥n se comportan diferente cuando el c√°lculo se hace en el hilo principal vs. en un worker.
  </app-info-box>

  <app-code-explanation summaryText="üìñ Ver C√≥digo - ¬øC√≥mo funciona?">
    <app-code-section title="1Ô∏è‚É£ Crear Worker para C√≥mputo">
      <pre><code>const worker = new Worker('worker.js');</code></pre>
    </app-code-section>
    <app-code-section title="2Ô∏è‚É£ Enviar Tarea al Worker">
      <pre><code>const count = 50000;
worker.postMessage({{ '{' }} count: count {{ '}' }});</code></pre>
    </app-code-section>
    <app-code-section title="3Ô∏è‚É£ Procesar en Worker">
      <pre><code>self.onmessage = function(e) {{'{'}}
    const {{ '{' }} count {{ '}' }} = e.data;
    const primes = calculatePrimes(count);
    self.postMessage({{ '{' }} primes: primes {{ '}' }});
{{ '}' }};</code></pre>
    </app-code-section>
    <app-code-section title="4Ô∏è‚É£ Recibir Resultado">
      <pre><code>worker.onmessage = function(e) {{'{'}}
    const primes = e.data.primes;
    console.log('C√°lculo completo:', primes);
{{ '}' }};</code></pre>
    </app-code-section>
  </app-code-explanation>

  <div class="demo-section">
    <h3>üî¢ Calculadora de N√∫meros Primos</h3>
    
    <div class="input-group">
      <label>¬øCu√°ntos n√∫meros primos calcular?</label>
      <input 
        type="number" 
        [ngModel]="count()"
        (ngModelChange)="count.set($event)"
        min="1000" 
        max="100000"
        step="1000"
      >
    </div>

    <div class="button-group">
      <button class="btn-worker" (click)="calculateWithWorker()" [disabled]="isLoading()">
        üöÄ Calcular con Worker<br>
        <small style="font-size: 11px; font-weight: normal;">(No bloquea la UI)</small>
      </button>
      <button class="btn-main" (click)="calculateInMainThread()" [disabled]="isLoading()">
        üêå Calcular en Hilo Principal<br>
        <small style="font-size: 11px; font-weight: normal;">(Bloquea la UI)</small>
      </button>
    </div>

    <div class="spinner" [class.active]="isLoading()"></div>
    
    @if (result(); as res) {
      <div class="result">
        <strong>‚úÖ C√°lculo completado con {{ res.method }}</strong><br>
        <strong>Total calculados:</strong> {{ res.primes.length.toLocaleString() }} n√∫meros primos<br>
        <strong>√öltimos 5:</strong> {{ res.primes.slice(-5).join(', ') }}<br>
        <strong>Tiempo transcurrido:</strong> {{ res.duration }} ms<br>
        <strong>N√∫mero primo m√°s grande:</strong> {{ res.primes[res.primes.length - 1].toLocaleString() }}
        @if (res.method === 'Hilo Principal') {
          <div class="warning">
            ‚ö†Ô∏è <strong>Nota:</strong> Durante este c√°lculo, la UI estuvo completamente congelada.
            El contador se detuvo y las animaciones dejaron de funcionar.
          </div>
        }
      </div>
    }
  </div>

  <div class="ui-test">
    <h3 style="margin-bottom: 10px;">üéØ Prueba de Respuesta de la UI</h3>
    <p style="font-size: 14px; opacity: 0.9;">Si la UI est√° bloqueada, este contador se congelar√°</p>
    <div class="counter">{{ counter() }}</div>
    <div class="animation-box"></div>
    <p style="font-size: 12px; opacity: 0.8;">
      La caja deber√≠a seguir rebotando suavemente
    </p>
  </div>
</div>

