<div class="example-content">
  <h1>{{ texts().title }}</h1>
  <p class="subtitle">{{ texts().subtitle }}</p>

  <app-info-box [title]="texts().infoTitle">
    {{ texts().infoDescription }}
  </app-info-box>

  <app-code-explanation [summaryText]="texts().codeSummary">
    <app-code-section [title]="texts().codeSections.createWorker">
      <pre><code>const worker = new Worker('worker.js');</code></pre>
    </app-code-section>
    <app-code-section [title]="texts().codeSections.sendTask">
      <pre><code>const count = 50000;
worker.postMessage({{ '{' }} count: count {{ '}' }});</code></pre>
    </app-code-section>
    <app-code-section [title]="texts().codeSections.processInWorker">
      <pre><code>self.onmessage = function(e) {{'{'}}
    const {{ '{' }} count {{ '}' }} = e.data;
    const primes = calculatePrimes(count);
    self.postMessage({{ '{' }} primes: primes {{ '}' }});
{{ '}' }};</code></pre>
    </app-code-section>
    <app-code-section [title]="texts().codeSections.receiveResult">
      <pre><code>worker.onmessage = function(e) {{'{'}}
    const primes = e.data.primes;
    console.log('CÃ¡lculo completo:', primes);
{{ '}' }};</code></pre>
    </app-code-section>
    <app-code-section tech="angular" [title]="texts().codeSections.createWorker">
      <pre><code class="language-typescript">ngOnInit() {{ '{' }}
  if (typeof Worker !== 'undefined') {{ '{' }}
    this.worker = new Worker(
      new URL('./offloading-computation.worker', import.meta.url),
      {{ '{' }} type: 'module' {{ '}' }}
    );
  {{ '}' }} else {{ '{' }}
    alert(this.texts().alerts.unsupported);
  {{ '}' }}
{{ '}' }}</code></pre>
    </app-code-section>
    <app-code-section tech="angular" [title]="texts().codeSections.sendTask">
      <pre><code class="language-typescript">calculateWithWorker() {{ '{' }}
  if (!this.worker) {{ '{' }}
    alert(this.texts().alerts.unsupported);
    return;
  {{ '}' }}

  const count = this.count();
  this.isLoading.set(true);
  this.result.set(null);
  this.startTime = performance.now();

  this.worker.postMessage({{ '{' }} count {{ '}' }});
{{ '}' }}</code></pre>
    </app-code-section>
    <app-code-section tech="angular" [title]="texts().codeSections.processInWorker">
      <pre><code class="language-typescript">/// offloading-computation.worker.ts
addEventListener('message', (event: MessageEvent<{{ '{' }} count: number {{ '}' }}>) => {{ '{' }}
  const primes = calculatePrimes(event.data.count);

  postMessage({{ '{' }}
    primes,
    count: primes.length
  {{ '}' }});
{{ '}' }});</code></pre>
    </app-code-section>
    <app-code-section tech="angular" [title]="texts().codeSections.receiveResult">
      <pre><code class="language-typescript">this.worker.onmessage = (event: MessageEvent<{{ '{' }} primes: number[]; count: number {{ '}' }}>) => {{ '{' }}
  const endTime = performance.now();
  const duration = Math.round(endTime - (this.startTime || 0));

  this.isLoading.set(false);
  this.result.set({{ '{' }}
    primes: event.data.primes,
    duration,
    method: 'worker'
  {{ '}' }});
{{ '}' }};

this.worker.onerror = (error: ErrorEvent) => {{ '{' }}
  console.error(error);
  this.isLoading.set(false);
{{ '}' }};</code></pre>
    </app-code-section>
  </app-code-explanation>

  <div class="demo-section">
    <h3>{{ texts().demo.title }}</h3>
    
    <div class="input-group">
      <label>{{ texts().demo.countLabel }}</label>
      <input 
        type="number" 
        [ngModel]="count()"
        (ngModelChange)="count.set($event)"
        min="1000" 
        max="100000"
        step="1000"
      >
    </div>

    <div class="button-group">
      <button class="btn-worker" (click)="calculateWithWorker()" [disabled]="isLoading()">
        {{ texts().demo.workerButton }}<br>
        <small style="font-size: 11px; font-weight: normal;">{{ texts().demo.workerNote }}</small>
      </button>
      <button class="btn-main" (click)="calculateInMainThread()" [disabled]="isLoading()">
        {{ texts().demo.mainButton }}<br>
        <small style="font-size: 11px; font-weight: normal;">{{ texts().demo.mainNote }}</small>
      </button>
    </div>

    <div class="spinner" [class.active]="isLoading()"></div>
    
    @if (result(); as res) {
      <div class="result">
        <strong>{{ texts().result.completedPrefix }} {{ texts().result.methodLabels[res.method] }}</strong><br>
        <strong>{{ texts().result.totalLabel }}</strong> {{ res.primes.length.toLocaleString() }} {{ texts().result.primesSuffix }}<br>
        <strong>{{ texts().result.lastFiveLabel }}</strong> {{ res.primes.slice(-5).join(', ') }}<br>
        <strong>{{ texts().result.durationLabel }}</strong> {{ res.duration }} {{ texts().result.durationUnit }}<br>
        <strong>{{ texts().result.largestLabel }}</strong> {{ res.primes[res.primes.length - 1].toLocaleString() }}
        @if (res.method === 'main') {
          <div class="warning">
            <strong>{{ texts().result.warningTitle }}</strong>
            {{ texts().result.warningDescription }}
          </div>
        }
      </div>
    }
  </div>

  <div class="ui-test">
    <h3 style="margin-bottom: 10px;">{{ texts().uiTest.title }}</h3>
    <p style="font-size: 14px; opacity: 0.9;">{{ texts().uiTest.info }}</p>
    <div class="counter">{{ counter() }}</div>
    <div class="animation-box"></div>
    <p style="font-size: 12px; opacity: 0.8;">
      {{ texts().uiTest.note }}
    </p>
  </div>
</div>

