<div class="container">
  <h1>ğŸš€ ComunicaciÃ³n BÃ¡sica con Web Workers</h1>
  <p class="subtitle">Ejemplo 01: Enviando y recibiendo mensajes</p>

  <div class="main-grid">
    <div class="content-column">
      <app-info-box title="ğŸ’¡ Â¿QuÃ© hace este ejemplo?">
        Este es el "Hola Mundo" de los Web Workers. Escribe un mensaje y envÃ­alo al worker.
        El worker lo recibirÃ¡, lo procesarÃ¡ y te responderÃ¡ de vuelta.
      </app-info-box>

      <app-code-explanation summaryText="ğŸ“– Ver CÃ³digo - Â¿CÃ³mo funciona?">
        <app-code-section title="1ï¸âƒ£ Crear el Worker">
          <pre><code>const myWorker = new Worker('worker.js');</code></pre>
        </app-code-section>
        <app-code-section title="2ï¸âƒ£ Enviar mensaje al Worker">
          <pre><code>myWorker.postMessage('Â¡Hola Worker!');</code></pre>
        </app-code-section>
        <app-code-section title="3ï¸âƒ£ Recibir mensaje en el Worker">
          <pre><code>self.onmessage = function(e) {{'{'}}
    const mensaje = e.data;
    const respuesta = 'ProcesÃ© tu mensaje: ' + mensaje;
    self.postMessage(respuesta);
{{ '}' }};</code></pre>
        </app-code-section>
        <app-code-section title="4ï¸âƒ£ Recibir respuesta del Worker">
          <pre><code>myWorker.onmessage = function(e) {{'{'}}
    const respuesta = e.data;
    console.log('Hilo principal recibiÃ³:', respuesta);
{{ '}' }};</code></pre>
        </app-code-section>
      </app-code-explanation>

      <div class="input-group">
        <label for="messageInput">Mensaje para el Worker:</label>
        <input
          type="text"
          id="messageInput"
          placeholder="Escribe tu mensaje aquÃ­..."
          [value]="messageText()"
          (input)="messageText.set($any($event.target).value)"
          (keypress)="onKeyPress($event)"
        >
      </div>

      <button (click)="sendMessage()">Enviar Mensaje al Worker</button>

      <div class="messages">
        @if (messages().length === 0) {
          <p style="color: #999; text-align: center; font-style: italic;">
            Los mensajes aparecerÃ¡n aquÃ­...
          </p>
        } @else {
          @for (msg of messages(); track $index) {
            <div class="message" [class.from-main]="msg.sender === 'main'" [class.from-worker]="msg.sender === 'worker'">
              <strong>{{ msg.sender === 'main' ? 'ğŸ“¤ Hilo Principal' : 'ğŸ“¥ Worker' }}</strong>
              <div>{{ msg.text }}</div>
            </div>
          }
        }
      </div>
    </div>

    <div class="sidebar-column">
      <div class="code-flow-standalone">
        <h3>ğŸ”„ Flujo de ComunicaciÃ³n</h3>
        <div class="flow-diagram">
          <div class="flow-step">Hilo Principal</div>
          <div class="flow-arrow">postMessage() â†“</div>
          <div class="flow-step">Worker</div>
          <div class="flow-arrow">â†‘ postMessage()</div>
          <div class="flow-step">Hilo Principal</div>
        </div>
      </div>
    </div>
  </div>
</div>

