<div class="example-content">
  <h1>{{ texts().title }}</h1>
  <p class="subtitle">{{ texts().subtitle }}</p>

  <div class="main-grid">
    <div class="content-column">
      <app-info-box [title]="texts().infoTitle">
        {{ texts().infoDescription }}
      </app-info-box>

      <app-code-explanation [summaryText]="texts().codeSummary">
        <app-code-section [title]="texts().codeSections.createWorker">
          <pre><code>const myWorker = new Worker('worker.js');</code></pre>
        </app-code-section>
        <app-code-section [title]="texts().codeSections.sendToWorker">
          <pre><code>myWorker.postMessage('¡Hola Worker!');</code></pre>
        </app-code-section>
        <app-code-section [title]="texts().codeSections.receiveInWorker">
          <pre><code>self.onmessage = function(e) {{'{'}}
    const mensaje = e.data;
    const respuesta = 'Procesé tu mensaje: ' + mensaje;
    self.postMessage(respuesta);
{{ '}' }};</code></pre>
        </app-code-section>
        <app-code-section [title]="texts().codeSections.receiveInMain">
          <pre><code>myWorker.onmessage = function(e) {{'{'}}
    const respuesta = e.data;
    console.log('Hilo principal recibió:', respuesta);
{{ '}' }};</code></pre>
        </app-code-section>
        <app-code-section tech="angular" [title]="texts().codeSections.createWorker">
          <pre><code class="language-typescript">ngOnInit() {{ '{' }}
  if (typeof Worker !== 'undefined') {{ '{' }}
    this.worker = new Worker(new URL('./basic-communication.worker', import.meta.url), {{ '{' }} type: 'module' {{ '}' }});
    this.worker.onmessage = (event: MessageEvent) => {{ '{' }}
      this.addMessage(event.data, 'worker');
    {{ '}' }};
  {{ '}' }} else {{ '{' }}
    alert('❌ Tu navegador no soporta Web Workers.');
  {{ '}' }}
{{ '}' }}</code></pre>
        </app-code-section>
        <app-code-section tech="angular" [title]="texts().codeSections.sendToWorker">
          <pre><code class="language-typescript">sendMessage() {{ '{' }}
  const message = this.messageText().trim();
  if (!message || !this.worker) {{ '{' }}
    return;
  {{ '}' }}

  this.addMessage(message, 'main');
  this.worker.postMessage(message);
  this.messageText.set('');
{{ '}' }}</code></pre>
        </app-code-section>
        <app-code-section tech="angular" [title]="texts().codeSections.receiveInWorker">
          <pre><code class="language-typescript">/// basic-communication.worker.ts
addEventListener('message', ({ data }) => {{ '{' }}
  const response = `Procesé tu mensaje: ${{ '{' }}data{{ '}' }}`;
  postMessage(response);
{{ '}' }});</code></pre>
        </app-code-section>
        <app-code-section tech="angular" [title]="texts().codeSections.receiveInMain">
          <pre><code class="language-typescript">this.worker.onmessage = (event: MessageEvent) => {{ '{' }}
  this.addMessage(event.data, 'worker');
{{ '}' }};

this.worker.onerror = (error: ErrorEvent) => {{ '{' }}
  this.addMessage(`Error: ${{ '{' }}error.message{{ '}' }}`, 'worker');
{{ '}' }};</code></pre>
        </app-code-section>
      </app-code-explanation>

      <div class="input-group">
        <label for="messageInput">{{ texts().messageLabel }}</label>
        <input
          type="text"
          id="messageInput"
          [placeholder]="texts().messagePlaceholder"
          [value]="messageText()"
          (input)="messageText.set($any($event.target).value)"
          (keypress)="onKeyPress($event)"
        >
      </div>

      <button (click)="sendMessage()">{{ texts().sendButton }}</button>

      <div class="messages">
        @if (messages().length === 0) {
          <p style="color: #999; text-align: center; font-style: italic;">
            {{ texts().emptyState }}
          </p>
        } @else {
          @for (msg of messages(); track $index) {
            <div class="message" [class.from-main]="msg.sender === 'main'" [class.from-worker]="msg.sender === 'worker'">
              <strong>{{ msg.sender === 'main' ? texts().senderMain : texts().senderWorker }}</strong>
              <div>{{ msg.text }}</div>
            </div>
          }
        }
      </div>
    </div>

    <div class="sidebar-column">
      <div class="code-flow-standalone">
        <h3>{{ texts().flowTitle }}</h3>
        <div class="flow-diagram">
          <div class="flow-step">{{ texts().flowSteps[0] }}</div>
          <div class="flow-arrow">{{ texts().flowSteps[1] }}</div>
          <div class="flow-step">{{ texts().flowSteps[2] }}</div>
          <div class="flow-arrow">{{ texts().flowSteps[3] }}</div>
          <div class="flow-step">{{ texts().flowSteps[4] }}</div>
        </div>
      </div>
    </div>
  </div>
</div>

